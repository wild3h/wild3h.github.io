<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>å†å†™ä»£ç å°±é€€ç½‘</title>
    <!--å¼•å…¥æœ¬åœ°xlsx.core.min.js-->
    <script src="xlsx.core.min.js"></script>
    <!--å¼•å…¥æœ¬åœ°xlsx.full.min.js-->
    <script src="xlsx.full.min.js"></script>
</head>
<style>
    #copy {
        width: 100px;
        height: 30px;
        background-color: #ccc;
        border: 1px solid #000;
        border-radius: 5px;
        text-align: center;
        line-height: 30px;
        cursor: pointer;
    }
</style>
<body>
    <!--åˆ›å»ºä¸€ä¸ªé€‰æ‹©æœ¬åœ°æ–‡ä»¶çš„æŒ‰é’®ï¼Œç„¶åè¯»å–è¯¥æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯Excelï¼Œè¯»å–æ¯ä¸€è¡Œæ•°æ®-->
    <input type="file" id="file" name="file" multiple="multiple" />
    <!--ä¸€é”®ç²˜è´´-->
    <div id="copy">
        ä¸€é”®å¤åˆ¶
    </div>
    <div id="result"></div>
</body>
<script>
    console.log('ğŸ¤£ğŸ‘‡ğŸ¤£\nğŸ‘‰ğŸ¤¡ğŸ‘ˆ\nğŸ¤£ğŸ‘†ğŸ¤£');
    var wb;//è¯»å–å®Œæˆçš„æ•°æ®
    var rABS = true; //æ˜¯å¦å°†æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²

    var file = document.getElementById('file');
    var result = document.getElementById('result');
    file.onchange = function () {
        var files = this.files;
        for (var i = 0; i < files.length; i++) {
            var file = files[i];
            var reader = new FileReader();
            if (rABS) {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsBinaryString(file);
            }
            reader.onload = function (e) {
                var data = e.target.result;
                if (rABS) {
                    wb = XLSX.read(btoa(fixdata(data)), {//æ‰‹åŠ¨è½¬åŒ–
                        type: 'base64'
                    });
                } else {
                    wb = XLSX.read(data, {

                        type: 'binary'//ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–
                    });
                }
                //console.log('XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]): ', XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]));
                let text = "{\"list\":"+JSON.stringify(XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]))+"}";
                //jsonæ ¼å¼åŒ–
                text = JSON.stringify(JSON.parse(text), null, 4).toString();
                console.log('text: ', text);
                document.getElementById("result").innerHTML = text;
            }
        }
    }

    function fixdata(data) { //æ–‡ä»¶æµè½¬BinaryString
        var o = "",
            l = 0,
            w = 10240;
        for (; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));
        o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));
        return o;
    }

    //ä¸€é”®ç²˜è´´
    document.getElementById('copy').onclick = function () {
        let text = document.getElementById("result").innerHTML;
        //å¤åˆ¶åˆ°å‰ªè´´æ¿
        var input = document.createElement('textarea');
        // éšè—æ­¤è¾“å…¥æ¡†
        input.style.position = 'absolute';
        input.style.clip = 'rect(0 0 0 0)';
        document.body.appendChild(input);
        input.value = text;
        input.focus();
        input.select();
        if (document.execCommand('copy')) {
            document.execCommand('copy');
            alert('å¤åˆ¶æˆåŠŸ');
        }
    }
    

</script>

</html>